/**
</> Original base BochilGaming 
</> Recode simple by @NeKosmic
**/

let handler=async(t,{conn:e,text:a})=>{if(e.hartatahta=e.hartatahta?e.hartatahta:{},t.chat in e.hartatahta)return t.reply("Aun estoy trabajando en una solicitud pendiente, por favor esper\xe9 su turno :D");e.hartatahta[t.chat]=!0;let r=await e.getName(t.sender);t.reply(MultiNK.Proces(r));try{let n=await ht(a||NombreDelBot);e.sendFile(t.chat,n,"HartaTahta.png",`*\xa9 Nurutomo*
Echo en FFmpeg ${a.length>15?"\n\n_[Consejo] : Use saltos de linea para realizar un trabajo perfecto!_":""}`,t)}finally{delete e.hartatahta[t.chat]}};handler.help=["imgtxt <texto>"],handler.tags=["fabricar"],handler.command=/^(imgtxt)$/i,handler.limit=!0;export default handler;import{spawn as t}from"child_process";import{readdirSync as e,readFileSync as a,unlinkSync as r}from"fs";import{join as n}from"path";let __dirname=global.__dirname(import.meta.url),src=n(__dirname,"../multimedia/"),tmp=n(__dirname,"../tmp/"),_font=n(src,"font"),aesthetic=n(src,"Aesthetic");function ht(o=""){return new Promise((i,l)=>{let h=n(aesthetic,pickRandom(e(aesthetic))),s=n(_font,"Roboto-Black.ttf"),d="1024x1024",c=`(${noise("X",2,1024,1)}+${noise("Y",1,1024,1)})/2+128`,m=`((${pickRandom(["","-"])}22.5*${pickRandom(["sin","cos"])}(X/1024*4*PI))+${noise("X",5,1024,.8)}+${noise("Y",2,1024,1)})/1.7+128`,$=o.startsWith(NombreDelBot)?230:130,_=[`[v:0]scale=${d}[im]`,textArgs("","black","white",$,s,"(w-text_w)/2","(h-text_h)/2-(text_h*1.5)",1024,1024)+"[top]",textArgs(o,"black","white",$,s,"(w-text_w)/2","(h-text_h)/2",1024,1024)+"[mid]",textArgs("","black","white",$,s,"(w-text_w)/2","(h-text_h)/2+(text_h*1.5)",1024,1024)+"[bot]","[top][mid]blend=all_mode=addition[con]","[con][bot]blend=all_mode=addition[txt]",`nullsrc=s=${d},geq='r=${c}:g=${c}:b=${c}'[dx]`,`nullsrc=s=${d},geq='r=${m}:g=${m}:b=${m}'[dy]`,"[txt][dx][dy]displace[wa]","[im][wa]blend=all_mode=multiply:all_opacity=1"],f=1*new Date+"_harta_tahta.png";f=n(tmp,f);let p=["-y","-i",h,"-filter_complex",_.join(";"),"-frames:v","1",f];t("ffmpeg",p).on("error",l).on("close",()=>{try{i(a(f)),r(f)}catch(t){l(t)}})})}function noise(t,e=4,a=1024,r){let n=[];for(let o=0;o<e;o++)n.push(formula(t,r*rand(40,80)*(a/2048)/a*((o+1)/5),rand(-Math.PI,Math.PI),(o+1)/e*8,0));return n.join("+")}function formula(t,e,a,r,n){return`(${n.toFixed(3)}+${r.toFixed(4)}*sin(${a.toFixed(6)}+2*PI*${t}*${e.toFixed(6)}))`}function textArgs(t,e,a,r,n,o="200",i="200",l=1024,h=1024){return`color=${e}:s=${l}x${h},drawtext=text='${t.replace(/[\\]/g,"\\$&")}':fontfile='${n.replace(/[\\]/g,"\\$&")}':x=${o}:y=${i}:fontsize=${r}:fontcolor=${a}`}function rand(t,e,a=.001){return Math.floor(Math.random()*(e-t)/a)*a}

/**
[_>] https://github.com/NeKosmic/
[_>] https://gitlab.com/NeKosmic/
**/