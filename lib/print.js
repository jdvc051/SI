/**
</> Original base BochilGaming 
</> Recode simple by @NeKosmic
**/

import{WAMessageStubType}from"@adiwajshing/baileys";import PhoneNumberfrom"awesome-phonenumber";import chalkfrom"chalk";import{watchFile}from"fs";import Helperfrom"./helper.js";import dbfrom"./database.js";import momentfrom"moment-timezone";const terminalImage=Helper.opts["img"]?(await import("terminal-image")).default:"";const urlRegex=(await import("url-regex-safe")).default({strict:!1});export default async function(e,t={user:{}}){let a,l=await t.getName(e.sender),o=PhoneNumber("+"+e.sender.replace("@s.whatsapp.net","")).getNumber("international")+(l?" ~"+l:""),n=await t.getName(e.chat);try{Helper.opts.img&&(a=!!/sticker|image/gi.test(e.mtype)&&await terminalImage.buffer(await e.download()))}catch(e){console.error(e)}let r=(e.msg?e.msg.vcard?e.msg.vcard.length:e.msg.fileLength?e.msg.fileLength.low||e.msg.fileLength:e.msg.axolotlSenderKeyDistributionMessage?e.msg.axolotlSenderKeyDistributionMessage.length:e.text?e.text.length:0:e.text?e.text.length:0)||0;db.data.users[e.sender],PhoneNumber("+"+((t.user?.jid||t.user?.id)?.replace("@s.whatsapp.net","")||"")).getNumber("international");if(console.log("[1;31m~[1;37m>",chalk.white("["),chalk.blue(e.isCommand?"EJECUTANDO":"MENSAJE"),chalk.white("]"),chalk.green("{"),chalk.rgb(255,131,0).underline(e.text||e.isCommand||e.mtype||"-"),chalk.yellow(r+["B",..."KMGTP"][Math.floor(Math.log(r)/Math.log(1e3))]||""),chalk.green("}"),chalk.blue(e.isCommand?"Por":"De"),chalk.cyan(l),"Chat",e.isGroup?chalk.bgGreen("grupo:"+n):chalk.bgRed("Privado:"+o),"Fecha",chalk.magenta(moment().tz(Intl.DateTimeFormat().resolvedOptions().timeZone).format("DD/MM/YY HH:mm:ss")).trim()),a&&console.log(a.trimEnd()),"string"==typeof e.text&&e.text){let a=e.text.replace(/\u200e+/g,""),l=/(?<=(?:^|[\s\n])\S?)(?:([*_~])(.+?)\1|```((?:.||[\n\r])+?)```)(?=\S?(?:[\s\n]|$))/g,o=(e=4)=>(t,a,n,r)=>{let s={_:"italic","*":"bold","~":"strikethrough"};return n=n||r,!s[a]||e<1?n:chalk[s[a]](n.replace(l,o(e-1)))};if(a.length<4096&&(a=a.replace(urlRegex,((e,t,a)=>{let l=e.length+t;return 0===t||l===a.length||/^\s$/.test(a[l])&&/^\s$/.test(a[t-1])?chalk.blueBright(e):e}))),a=a.replace(l,o(4)),e.mentionedJid)for(let l of e.mentionedJid)a=a.replace("@"+l.split`@`[0],chalk.blueBright("@"+await t.getName(l)))}if(e.messageStubParameters.length&&console.log(e.messageStubParameters.map((e=>{e=t.decodeJid(e);let a=t.getName(e);return chalk.gray(PhoneNumber("+"+e.replace("@s.whatsapp.net","")).getNumber("international")+(a?" ~"+a:""))})).join(", ")),/document/i.test(e.mtype))console.log(`📄 ${e.msg.fileName||e.msg.displayName||"Document"}`);else if(/ContactsArray/i.test(e.mtype))console.log("👨‍👩‍👧‍👦  ");else if(/contact/i.test(e.mtype))console.log(`👨 ${e.msg.displayName||""}`);else if(/audio/i.test(e.mtype)){const t=e.msg.seconds;console.log(`${e.msg.ptt?"🎤 (PTT ":"🎵 ("}AUDIO) ${Math.floor(t/60).toString().padStart(2,0)}:${(t%60).toString().padStart(2,0)}`)}console.log()}let file=Helper.__filename(import.meta.url);watchFile(file,(()=>{console.log(chalk.cyan("\n["+file+"] Fue actualizado con exito!\n"))}));

/**
[_>] https://github.com/NeKosmic/
[_>] https://gitlab.com/NeKosmic/
**/